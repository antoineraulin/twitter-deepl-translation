var userLang=navigator.language||navigator.userLanguage;userLang=userLang.toUpperCase();if(userLang.indexOf("-")){userLang=userLang.substring(0,2);}
chrome.runtime.onConnectExternal.addListener(function(port){port.onMessage.addListener(function(request){console.log(request);var id=request.id;var xhr=new XMLHttpRequest();xhr.open("POST","https://www.deepl.com/jsonrpc",!0);xhr.setRequestHeader("Content-type","application/json");xhr.onreadystatechange=function(){if(xhr.readyState===4&&xhr.status===200){var json=JSON.parse(xhr.responseText);var beams=json.result.translations;beams.forEach(element=>{try{var langue=json.result.source_lang;var transText=element.beams[0].postprocessed_sentence;transText=transText.replace("2005/","<");if(request.multi){port.postMessage({error:!1,data:transText,id:id,multi:true,array:request.array,i:request.i});console.log("sent!");}else{port.postMessage({error:!1,data:transText,id:id,multi:false});console.log("sent!");}}catch(e){port.postMessage({error:!0,info:"catch",id:id})}})}};var data=JSON.stringify({"jsonrpc":"2.0","method":"LMT_handle_jobs","params":{"jobs":[{"kind":"default","raw_en_sentence":request.data}],"lang":{"user_preferred_langs":["EN","FR"],"source_lang_user_selected":"auto","target_lang":userLang},"priority":-1},"id":1});xhr.send(data)});});